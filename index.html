<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IMPERIAL TECHUB</title>

  <!-- Inline tiny IT favicon (SVG) -->
  <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjMDAyMzY2IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiI+PHRleHQgeD0iNCIgeT0iMjQiIGZvbnQtc2l6ZT0iMjQiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmaWxsPSJ3aGl0ZSI+SVQ8L3RleHQ+PC9zdmc+" />

  <style>
    :root{
      --royal:#002366;
      --accent:#00b4ff;
      --glass: rgba(255,255,255,0.06);
      --muted: rgba(224,224,224,0.9);
      --bg:#fbfdff;
      --text:#002b4d;
    }
    *{box-sizing:border-box}
    body {
      margin:0; font-family: "Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
      background: linear-gradient(135deg,var(--royal), #003b99); color:#fff; -webkit-font-smoothing:antialiased;
      min-height:100vh; overflow-x:hidden;
    }

    /* ===== SPLASH (5 seconds) ===== */
    #splash {
      position: fixed; inset:0; display:flex; align-items:center; justify-content:center; flex-direction:column;
      z-index: 9999; background: #001f4d; pointer-events: none;
      animation: splashHold 4.5s linear forwards;
    }
    @keyframes splashHold { 0%{opacity:1} 90%{opacity:1} 100%{opacity:0; visibility:hidden} }
    #splash-text { font-size:clamp(2rem,6vw,4rem); color:#cfe9ff; font-weight:900; letter-spacing:2px; animation:textGlow 4s ease-in-out 0.5s forwards; }
    @keyframes textGlow { 0%{opacity:0;transform:scale(.9)} 20%{opacity:1;transform:scale(1)} 90%{opacity:1} 100%{opacity:0} }

    /* glowing pulse below text */
    .pulse {
      margin-top:18px; width:18px; height:18px; border-radius:50%; background:var(--accent);
      box-shadow: 0 0 0 rgba(0,180,255,0.4);
      animation: pulseAnim 1.6s infinite;
    }
    @keyframes pulseAnim {
      0%{ box-shadow:0 0 0 0 rgba(0,180,255,0.45) }
      60%{ box-shadow:0 0 0 26px rgba(0,180,255,0) }
      100%{ box-shadow:0 0 0 0 rgba(0,180,255,0) }
    }

    /* SITE wrapper, becomes visible after splash */
    #site { opacity:0; transition: opacity 0.6s ease-in-out; padding-bottom:84px; }

    /* NAV */
    header.navbar { position: sticky; top:0; z-index:900; background: rgba(0,0,0,0.12); backdrop-filter: blur(6px); border-bottom:1px solid rgba(255,255,255,0.02); }
    .nav-inner { max-width:1100px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; padding:10px 16px; gap:12px; }
    .brand { display:flex; align-items:center; gap:12px; color:#fff; font-weight:800; }
    .logo { width:44px; height:44px; border-radius:8px; background: linear-gradient(135deg,var(--accent),#62d3ff); display:flex; align-items:center; justify-content:center; color:#012; font-weight:900; }
    .nav-links { display:flex; gap:8px; flex-wrap:wrap; }
    .nav-links button { background:transparent; border:0; color:#fff; padding:8px 12px; border-radius:8px; font-weight:700; cursor:pointer; transition:all .12s; }
    .nav-links button.active { color:var(--accent); background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); }

    main { max-width:1100px; margin:20px auto; padding:0 16px; }
    section { display:none; padding:12px 0 40px 0; }
    section.active { display:block; animation: fadeIn .5s ease; }
    @keyframes fadeIn { from{opacity:0; transform:translateY(6px)} to{opacity:1;transform:none} }

    .card { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:12px; padding:16px; border:1px solid rgba(255,255,255,0.03); box-shadow:0 8px 30px rgba(0,0,0,0.35); color:#fff; }

    .funfact { text-align:center; display:inline-block; padding:18px; border-radius:12px; background: rgba(255,255,255,0.03); max-width:780px; }

    /* Events grid */
    .events-grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(260px,1fr)); gap:14px; margin-top:12px; }
    .event-card { padding:12px; border-radius:10px; text-align:center; background: rgba(255,255,255,0.03); }
    .countdown { font-family: 'Courier New', monospace; font-weight:800; color:var(--accent); margin-top:8px; font-size:1.05rem; }

    /* Leaders */
    .leaders-grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap:12px; margin-top:12px; }
    .leader-card { background: rgba(255,255,255,0.03); padding:12px; border-radius:10px; text-align:left; color:#fff; }
    .wa-btn { background: linear-gradient(90deg,#25D366,#128C7E); color:#012; padding:8px 10px; border-radius:8px; font-weight:800; text-decoration:none; margin-right:8px; }
    .call-btn { background: linear-gradient(90deg,#ffd54f,#ffb300); color:#012; padding:8px 10px; border-radius:8px; font-weight:700; text-decoration:none; }

    /* Hymnbook */
    .hymn-search { display:flex; gap:8px; align-items:center; margin-bottom:12px; }
    .hymn-search input { flex:1; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:#fff; }

    .hymn-list { display:flex; flex-direction:column; gap:8px; max-height:420px; overflow:auto; padding-right:6px; }
    .hymn-item { padding:10px; border-radius:8px; background: rgba(255,255,255,0.03); cursor:pointer; border:1px solid rgba(255,255,255,0.02); }
    .hymn-lyrics { display:none; margin-top:8px; color:#e9f3ff; white-space:pre-line; }

    /* Membership cards */
    .membership-grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap:14px; margin-top:12px; }
    .membership-card { background: rgba(255,255,255,0.03); padding:14px; border-radius:10px; text-align:center; }
    .buy-btn { padding:10px 14px; border-radius:8px; border:0; cursor:pointer; font-weight:800; color:#012; background: var(--accent); }

    /* Modal (Jitsi and MiniPay) */
    .modal { display:none; position:fixed; inset:0; background: rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:10000; }
    .modal-inner { width:94%; max-width:900px; background:#fff; color:#012; border-radius:10px; overflow:hidden; }
    .modal-top { display:flex; justify-content:space-between; align-items:center; padding:8px 12px; background:var(--royal); color:#fff; }
    .modal-body { padding:0; }
    .modal-body iframe { width:100%; height:640px; border:0; display:block; }
    .modal-close { background:#ff7676; border:0; color:#012; padding:8px 12px; border-radius:8px; cursor:pointer; }

    footer.app-footer { position:fixed; left:0; right:0; bottom:0; background: rgba(0,0,20,0.6); color: rgba(240,240,240,0.95); padding:10px 12px; text-align:center; z-index:9999; border-top:1px solid rgba(255,255,255,0.03); }
    footer.app-footer strong{ color:#fff; }

    @media (max-width:760px) {
      .modal-body iframe { height:420px; }
    }
  </style>
</head>
<body>
  <!-- SPLASH -->
  <div id="splash" aria-hidden="true">
    <div id="splash-text">IMPERIAL TECHUB</div>
    <div class="pulse"></div>
  </div>

  <!-- SITE -->
  <div id="site" aria-hidden="true">
    <header class="navbar">
      <div class="nav-inner">
        <div class="brand"><div class="logo">IT</div><div style="font-weight:800">IMPERIAL TECHUB</div></div>
        <div class="nav-links" role="menubar" aria-label="Sections">
          <button data-section="home" class="active">HOME</button>
          <button data-section="events">EVENTS</button>
          <button data-section="announcements">ANNOUNCEMENTS</button>
          <button data-section="calendar">CALENDAR</button>
          <button data-section="leaders">LEADERS</button>
          <button data-section="hymnbook">HYMNBOOK</button>
          <button data-section="membership">MEMBERSHIP</button>
          <button data-section="video">VIDEO FELLOWSHIP</button>
        </div>
      </div>
    </header>

    <main>
      <!-- HOME -->
      <section id="home" class="active">
        <div class="card funfact" style="margin:16px auto; max-width:900px;">
          <h2>ðŸ’¡ Fun Fact</h2>
          <p id="funFact">Loading...</p>
          <small style="color:var(--muted)">Changes daily â€” come back tomorrow for a new fact.</small>
        </div>
      </section>

      <!-- EVENTS -->
      <section id="events">
        <div class="card" style="margin:16px auto;">
          <h2>ðŸ“… Upcoming Events â€” Live Countdowns</h2>
          <div class="events-grid" id="eventsGrid" style="margin-top:12px;"></div>
        </div>
      </section>

      <!-- ANNOUNCEMENTS -->
      <section id="announcements">
        <div class="card announce" style="margin:16px auto;">
          <h2>ðŸ“£ Announcements</h2>
          <div>
            <h3>PCEA NGORANO PARISH YOUTH RALLY</h3>
            <p><strong>Sunday, 16th November 2025 â€” PCEA Chieni Church</strong></p>
            <p>All youths are encouraged to attend for fellowship, worship, and spiritual growth. To God be the Glory.</p>
          </div>
          <hr style="border:none;border-top:1px solid rgba(255,255,255,0.04);margin:12px 0;">
          <div>
            <h3>PRESBYTERY YOUTH CONVENTION</h3>
            <p><strong>Tuesday, 2nd December â€“ Saturday, 6th December 2025</strong></p>
            <p>Charges: Ksh. 1,500 per person (payable in small instalments). To God be the Glory.</p>
          </div>
        </div>
      </section>

      <!-- CALENDAR -->
      <section id="calendar">
        <div class="card" style="margin:16px auto;">
          <h2>ðŸ—“ Calendar</h2>
          <ul class="calendar-list" id="calendarList" style="margin-top:12px;"></ul>
        </div>
      </section>

      <!-- LEADERS -->
      <section id="leaders">
        <div class="card" style="margin:16px auto;">
          <h2>ðŸ‘¥ Leaders & Contacts</h2>
          <div class="leaders-grid" id="leadersGrid" style="margin-top:12px;"></div>
        </div>
      </section>

      <!-- HYMNBOOK -->
      <section id="hymnbook">
        <div class="card" style="margin:16px auto;">
          <h2>ðŸŽµ Hymnbook</h2>
          <div class="hymn-search" style="margin-top:12px;">
            <input id="hymnQuery" placeholder="Search hymn by title or any line..." aria-label="Search hymns" />
            <button id="clearHymn" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.06);color:#fff;cursor:pointer">Clear</button>
          </div>
          <div class="hymn-list" id="hymnList" style="margin-top:12px;"></div>
          <small style="display:block;margin-top:12px;color:var(--muted)">Click a hymn to expand the full lyrics.</small>
        </div>
      </section>

      <!-- MEMBERSHIP (MiniPay modal) -->
      <section id="membership">
        <div class="card" style="margin:16px auto;">
          <h2>ðŸ’› Support & Membership</h2>
          <p>Choose a membership tier to support youth programs. Payments are processed securely via MiniPay.</p>

          <div class="membership-grid">
            <div class="membership-card">
              <h3>Gold</h3>
              <p><strong>Ksh 300 / month</strong></p>
              <button class="buy-btn" data-plan="Gold" data-amount="300">Buy Gold</button>
            </div>

            <div class="membership-card">
              <h3>Platinum</h3>
              <p><strong>Ksh 500 / month</strong></p>
              <button class="buy-btn" data-plan="Platinum" data-amount="500">Buy Platinum</button>
            </div>

            <div class="membership-card">
              <h3>Diamond</h3>
              <p><strong>Ksh 1000 / month</strong></p>
              <button class="buy-btn" data-plan="Diamond" data-amount="1000">Buy Diamond</button>
            </div>
          </div>

          <small style="display:block;margin-top:10px;color:var(--muted)">Payments handled by MiniPay â€” secure and mobile friendly.</small>
        </div>
      </section>

      <!-- VIDEO FELLOWSHIP -->
      <section id="video">
        <div class="card video-card" style="margin:16px auto;">
          <h2>ðŸŽ¥ Video Fellowship</h2>
          <p style="color:var(--muted)">Click <strong>Join Meeting</strong> to open a fresh, secure meeting room in a pop-up. The room is unique for each session.</p>
          <div style="display:flex;gap:10px;flex-wrap:wrap;">
            <button id="joinVideoBtn" style="padding:10px 14px;border-radius:8px;border:0;background:var(--accent);color:#012;font-weight:800;cursor:pointer">Join Meeting</button>
            <button id="leaveVideoBtn" style="padding:10px 14px;border-radius:8px;border:0;background:#ff7676;color:#012;font-weight:800;cursor:pointer;display:none">Leave Meeting</button>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- MODALS -->
  <!-- Jitsi meeting modal -->
  <div id="jitsiModal" class="modal" aria-hidden="true">
    <div class="modal-inner" role="dialog" aria-modal="true" aria-labelledby="jitsiTitle">
      <div class="modal-top">
        <div id="jitsiTitle">Youth Fellowship Meeting</div>
        <div><button class="modal-close" id="jitsiCloseBtn">Leave</button></div>
      </div>
      <div class="modal-body" id="jitsiBody">
        <!-- Jitsi iframe will be injected here by External API (in a child div) -->
      </div>
    </div>
  </div>

  <!-- MiniPay modal -->
  <div id="minipayModal" class="modal" aria-hidden="true">
    <div class="modal-inner" role="dialog" aria-modal="true" aria-labelledby="mpTitle">
      <div class="modal-top">
        <div id="mpTitle">Complete Payment</div>
        <div><button class="modal-close" id="mpCloseBtn">Close</button></div>
      </div>
      <div class="modal-body" id="mpBody" style="padding:0;">
        <!-- We'll try to embed the MiniPay checkout in an iframe -->
        <iframe id="mpIframe" src="" style="width:100%;height:640px;border:0;"></iframe>
      </div>
    </div>
  </div>

  <footer class="app-footer" role="contentinfo">
    <div>PROUDLY CREATED BY <strong>IAN GATHAGU</strong></div>
    <div style="opacity:0.9">v1.3.3</div>
  </footer>

  <!-- SCRIPTS -->
  <script>
    /**********************
     * SITE INITIALIZATION
     **********************/
    // Show site after splash finishes (5s total: 4.5s animation + 0.5s)
    window.addEventListener('load', () => {
      setTimeout(() => {
        const splash = document.getElementById('splash');
        splash.style.transition = 'opacity 0.6s ease';
        splash.style.opacity = '0';
        setTimeout(() => {
          splash.style.display = 'none';
          document.getElementById('site').style.opacity = '1';
          // initialize features
          activateNavButton('home');
          showSection('home');
          setFunFactOfTheDay();
          initEvents();
          renderCalendar();
          renderLeaders();
          loadHymns();
          // preload jitsi external api for faster joins
          preloadScript('https://meet.jit.si/external_api.js');
        }, 600);
      }, 4500); // end of visual splash animation
    });

    /* ---------- NAVIGATION ---------- */
    (function(){
      const nav = document.querySelector('.nav-links');
      nav.addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-section]');
        if(!btn) return;
        const section = btn.getAttribute('data-section');
        activateNavButton(section);
        showSection(section);
        if(section === 'video') {
          // optional: scroll to top of main
          window.scrollTo({top:0, behavior:'smooth'});
        }
      });
    })();

    function activateNavButton(section){
      document.querySelectorAll('.nav-links button').forEach(b => b.classList.toggle('active', b.getAttribute('data-section') === section));
    }
    function showSection(sectionId){
      document.querySelectorAll('main section').forEach(s => s.classList.remove('active'));
      const el = document.getElementById(sectionId);
      if(el) el.classList.add('active');
    }

    /* ---------- FUN FACT (daily) ---------- */
    const FUN_FACTS = [
      "Jesus had 12 disciples â€” the same number of months in a year!",
      "The Bible is the most translated book in the world.",
      "David was the youngest of his brothers â€” yet chosen by God.",
      "There are many verses reminding us to trust God daily."
    ];
    function setFunFactOfTheDay(){
      const today = new Date().toDateString();
      let saved = null;
      try { saved = JSON.parse(localStorage.getItem('it_funFact')); } catch(e){ saved = null; }
      if(!saved || saved.date !== today){
        const idx = Math.floor(Math.random() * FUN_FACTS.length);
        const entry = { date: today, fact: FUN_FACTS[idx] };
        try { localStorage.setItem('it_funFact', JSON.stringify(entry)); } catch(e){}
        document.getElementById('funFact').innerText = entry.fact;
      } else {
        document.getElementById('funFact').innerText = saved.fact;
      }
    }

    /* ---------- EVENTS & COUNTDOWNS ---------- */
    const EVENTS = [
      { id:'youth-rally', title:'Youth Rally â€” PCEA Chieni Church', start:'2025-11-16T09:00:00', end:'2025-11-16T17:00:00', location:'PCEA Chieni Church' },
      { id:'presbytery-convention', title:'Presbytery Youth Convention', start:'2025-12-02T09:00:00', end:'2025-12-06T18:00:00', location:'Presbytery Venue' },
      { id:'christmas', title:'Christmas Day', start:'2025-12-25T00:00:00', end:'2025-12-25T23:59:59', location:'All Parishes' },
      { id:'new-year', title:"New Year's Day", start:'2026-01-01T00:00:00', end:'2026-01-01T23:59:59', location:'All Parishes' }
    ];
    let countdownInterval = null;
    function initEvents(){
      EVENTS.forEach(e => { e.startDate = new Date(e.start); e.endDate = new Date(e.end); });
      renderEvents();
      if(countdownInterval) clearInterval(countdownInterval);
      countdownInterval = setInterval(updateCountdowns, 1000);
      updateCountdowns();
    }
    function renderEvents(){
      const container = document.getElementById('eventsGrid');
      container.innerHTML = '';
      const now = new Date();
      const mapped = EVENTS.map(e=>{
        let diff;
        if(now > e.endDate) diff = Infinity;
        else if(now >= e.startDate && now <= e.endDate) diff = 0;
        else diff = e.startDate - now;
        return {...e, diff};
      }).sort((a,b)=> a.diff - b.diff);
      mapped.forEach(e=>{
        const div = document.createElement('div');
        div.className = 'event-card';
        div.id = 'card-'+e.id;
        div.innerHTML = `
          <h3 style="margin:0 0 6px 0">${e.title}</h3>
          <div style="color:rgba(224,224,224,0.85);font-size:0.95rem">${formatDateRange(e.startDate,e.endDate)}</div>
          <div class="countdown" id="cd-${e.id}">--d --h --m --s</div>
          <div style="color:rgba(224,224,224,0.85);font-size:0.95rem;margin-top:8px">Location: ${e.location}</div>
        `;
        container.appendChild(div);
      });
    }
    function updateCountdowns(){
      const now = new Date();
      EVENTS.forEach(e=>{
        const el = document.getElementById('cd-'+e.id);
        if(!el) return;
        if(now > e.endDate){ el.innerText = 'Event Passed'; el.style.color = 'rgba(255,255,255,0.6)'; return; }
        if(now >= e.startDate && now <= e.endDate){ el.innerText = 'Now Happening!'; el.style.color = '#ffdd57'; return; }
        let diff = e.startDate - now;
        const days = Math.floor(diff / (24*60*60*1000)); diff -= days*(24*60*60*1000);
        const hours = Math.floor(diff / (60*60*1000)); diff -= hours*(60*60*1000);
        const minutes = Math.floor(diff / (60*1000)); diff -= minutes*(60*1000);
        const seconds = Math.floor(diff/1000);
        el.innerText = `${pad(days)}d ${pad(hours)}h ${pad(minutes)}m ${pad(seconds)}s`;
        el.style.color = 'var(--accent)';
      });
    }
    function formatDateRange(s,e){
      const opts = { year:'numeric', month:'long', day:'numeric' };
      if(s.toDateString() === e.toDateString()) return s.toLocaleDateString(undefined, opts);
      return s.toLocaleDateString(undefine

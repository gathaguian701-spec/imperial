<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IMPERIAL TECHUB</title>
  <meta name="description" content="Imperial Techub - PCEA Center Youth site" />
  <style>
    :root{
      --royal:#002366; --accent:#00b4ff; --muted: rgba(230,230,230,0.85);
      --card: rgba(255,255,255,0.04); --glass: rgba(255,255,255,0.03);
      --maxw: 1100px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family: Inter,system-ui,Segoe UI,Roboto,Arial;
      background: linear-gradient(140deg,var(--royal), #003b99);
      color:#fff;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    a{color:inherit}
    .center{text-align:center}
    main{max-width:var(--maxw);margin:18px auto;padding:0 14px}

    /* INTRO, 5s */
    #intro {
      position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;
      background:#001F4D;z-index:9999;animation:introFade 5s linear forwards;
    }
    @keyframes introFade{0%{opacity:1}95%{opacity:1}100%{opacity:0;visibility:hidden}}
    #intro h1{font-size:clamp(2rem,6vw,4rem);letter-spacing:2px;color:#cfe9ff;font-weight:900;margin-bottom:10px}
    .pulse{width:20px;height:20px;border-radius:50%;background:var(--accent);box-shadow:0 0 0 rgba(0,180,255,0.4);animation:pulse 1.5s infinite}
    @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(0,180,255,.45)}60%{box-shadow:0 0 0 26px rgba(0,180,255,0)}100%{box-shadow:0 0 0 0 rgba(0,180,255,0)}}

    /* top nav (hidden until login) */
    .topbar{position:sticky;top:0;background:rgba(0,0,0,0.12);backdrop-filter:blur(6px);border-bottom:1px solid rgba(255,255,255,0.03);z-index:900;display:none}
    .nav-inner{max-width:var(--maxw);margin:0 auto;padding:10px 14px;display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#62d3ff);display:flex;align-items:center;justify-content:center;color:#012;font-weight:900}
    .nav-links{display:flex;gap:8px;flex-wrap:wrap}
    .nav-btn{background:transparent;border:0;color:#fff;padding:8px 12px;border-radius:8px;font-weight:700;cursor:pointer}
    .nav-btn.active{color:var(--accent);background:rgba(255,255,255,0.03)}

    /* page card */
    .card{background:var(--card);border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 12px 36px rgba(0,0,0,0.35)}
    .form-row{display:flex;gap:8px;flex-wrap:wrap}
    input, select, textarea{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;width:100%}
    button{padding:10px 12px;border-radius:8px;border:0;background:var(--accent);color:#012;font-weight:800;cursor:pointer}
    .muted{color:var(--muted);font-size:.95rem}footer{margin-top:22px;text-align:center;color:rgba(255,255,255,0.95);padding-bottom:28px}

    /* responsive */
    @media (max-width:760px){
      .nav-links{display:none}
    }

    /* small helpers */
    .hidden{display:none !important}
  </style>
</head>
<body>

  <!-- Intro -->
  <div id="intro" aria-hidden="true">
    <h1>IMPERIAL TECHUB</h1>
    <div class="pulse" aria-hidden="true"></div>
  </div>

  <!-- Topnav (hidden until login completes) -->
  <header class="topbar" id="topbar" aria-hidden="true">
    <div class="nav-inner">
      <div class="brand"><div class="logo">IT</div><div><strong>IMPERIAL TECHUB</strong></div></div>
      <nav class="nav-links" id="navlinks" aria-label="Main navigation">
        <button class="nav-btn" data-page="home">HOME</button>
        <button class="nav-btn" data-page="events">EVENTS</button>
        <button class="nav-btn" data-page="announcements">ANNOUNCEMENTS</button>
        <button class="nav-btn" data-page="calendar">CALENDAR</button>
        <button class="nav-btn" data-page="leaders">LEADERS</button>
        <button class="nav-btn" data-page="hymnbook">HYMNBOOK</button>
        <button class="nav-btn" data-page="membership">MEMBERSHIP</button>
        <button class="nav-btn" data-page="video">MEETING</button>
        <button class="nav-btn" data-page="bible">BIBLE</button>
        <button class="nav-btn" data-page="chat">CHAT</button>
      </nav>
    </div>
  </header>

  <main>
    <!-- AUTH (Login) - shown after intro, nav hidden while auth visible -->
    <section id="authSection">
      <div style="max-width:920px;margin:48px auto" class="card center">
        <h2>Sign in to IMPERIAL TECHUB</h2>
        <div style="margin-top:14px;max-width:640px">
          <div class="form-row" style="margin-bottom:8px">
            <input id="signinEmail" placeholder="Email" />
          </div>
          <div class="form-row" style="margin-bottom:14px">
            <input id="signinPassword" placeholder="Password" type="password" />
          </div>
          <div style="display:flex;gap:8px;justify-content:center">
            <button id="btnSignIn">Sign In</button>
            <button id="btnOpenRegister" style="background:#3b82f6">Create account</button>
          </div>
          <div id="signinMsg" class="muted" style="margin-top:10px"></div>
        </div>
      </div>
    </section>

    <!-- Register modal (hidden by default) -->
    <div id="registerModal" class="hidden" style="position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:999">
      <div style="background:#fff;color:#012;padding:16px;border-radius:10px;width:760px;max-width:96%">
        <h3>Create an account</h3>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px">
          <input id="regFullName" placeholder="Full name" />
          <input id="regUsername" placeholder="Username" />
          <input id="regEmail" placeholder="Email" />
          <input id="regPhone" placeholder="Phone (+254...)" />
          <input id="regChurch" placeholder="Church" />
          <input id="regDistrict" placeholder="District" />
          <label style="grid-column:1/3">Profile photo: <input id="regPhoto" type="file" accept="image/*" /></label>
          <input id="regPassword" type="password" placeholder="Password" />
          <input id="regPassword2" type="password" placeholder="Confirm password" />
        </div>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
          <button id="btnCancelRegister" style="background:#ddd;color:#012">Cancel</button>
          <button id="btnCreateAccount">Create account</button>
        </div>
        <div id="regMsg" style="margin-top:8px;color:#333"></div>
      </div>
    </div><!-- The full app (hidden until login) -->
    <div id="appWrapper" class="hidden">
      <section id="home" class="card" style="margin:18px 0">
        <h2>Welcome</h2>
        <p id="welcomeText" class="muted">Welcome to IMPERIAL TECHUB.</p>
      </section>

      <section id="contentGrid" style="display:grid;grid-template-columns:1fr 1fr;gap:14px">
        <div class="card">
          <h3>Events (countdowns)</h3>
          <div id="eventsGrid"></div>
        </div>
        <div class="card">
          <h3>Announcements</h3>
          <div><strong>PCEA NGORANO PARISH YOUTH RALLY</strong><p class="muted">Sunday, 16th November 2025 — PCEA Chieni Church</p></div>
          <div style="margin-top:8px"><strong>PRESBYTERY YOUTH CONVENTION</strong><p class="muted">2nd — 6th December 2025 — Fee Ksh 1,500</p></div>
        </div>
      </section>

      <section class="card" style="margin-top:14px">
        <h3>Leaders</h3>
        <div id="leadersGrid"></div>
      </section>

      <footer>PROUDLY CREATED BY <strong>IAN GATHAGU</strong> — v1.3.5</footer>
    </div>
  </main>

  <!-- Firebase libs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

  <script>
    // ------------------------
    // Firebase config (your config)
    // ------------------------
    const firebaseConfig = {
      apiKey: "AIzaSyBNnNfTHE6h-hnTW6LAixiAJ7X--HMTMA0",
      authDomain: "imperial-techub.firebaseapp.com",
      projectId: "imperial-techub",
      storageBucket: "imperial-techub.firebasestorage.app",
      messagingSenderId: "361070773876",
      appId: "1:361070773876:web:ce41754e58a058e827f321"
    };

    // ensure firebase scripts loaded
    if(typeof firebase === 'undefined'){ alert('Firebase SDK failed to load. Check network.'); }

    // initialize
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // ------------------------
    // UI helpers
    // ------------------------
    const $ = id => document.getElementById(id);
    const add = (el, html) => el.insertAdjacentHTML('beforeend', html);
    const show = el => el.classList.remove('hidden');
    const hide = el => el.classList.add('hidden');

    // ------------------------
    // Intro: after 5s intro hides automatically (CSS animation does this)
    // We'll also ensure auth UI shows after intro completes.
    // ------------------------
    function readyAfterIntro(){
      // show auth section (nav remains hidden)
      show($('authSection'));
      hide($('appWrapper'));
      // register intro end listener fallback
      const intro = $('intro');
      intro.addEventListener('animationend', ()=> {
        intro.style.display = 'none';
        // show auth UI (already visible)
      });
    }
    // call after small timeout in case animationend missed
    setTimeout(readyAfterIntro, 5100);

    // ------------------------
    // Wire auth UI
    // ------------------------
    $('btnOpenRegister').addEventListener('click', ()=> {
      $('registerModal').classList.remove('hidden');
      $('registerModal').style.display = 'flex';
    });
    $('btnCancelRegister').addEventListener('click', ()=> {
      $('registerModal').classList.add('hidden');
      $('registerModal').style.display = 'none';
    });

    $('btnSignIn').addEventListener('click', async ()=> {
      const email = $('signinEmail').value.trim();
      const pw = $('signinPassword').value;
      if(!email || !pw){ $('signinMsg').innerText = 'Enter email and password'; return; }
      $('signinMsg').innerText = 'Signing in...';
      try{
        await auth.signInWithEmailAndPassword(email, pw);
        $('signinMsg').innerText = '';
        // onAuthStateChanged will handle UI
      } catch(err){
        console.error(err);
        $('signinMsg').innerText = 'Sign-in error: ' + err.message;
      }
    });

    // Register flow
    $('btnCreateAccount').addEventListener('click', async ()=>{
      const fullName = $('regFullName').value.trim();
      const username = $('regUsername').value.trim();
      const email = $('regEmail').value.trim();
      const phone = $('regPhone').value.trim();
      const church = $('regChurch').value.trim();
      const district = $('regDistrict').value.trim();
      const pass = $('regPassword').value;
      const pass2 = $('regPassword2').value;
      if(!fullName || !username || !email || !phone || !pass){ $('regMsg').innerText = 'Please fill required fields'; return; }
      if(pass !== pass2){ $('regMsg').innerText = 'Passwords do not match'; return; }
      $('regMsg').innerText = 'Creating account...';
      try{
        const cred = await auth.createUserWithEmailAndPassword(email, pass);
        const uid = cred.user.uid;
        // upload photo if present
        let photoURL = '';
        const file = $('regPhoto').files[0];
        if(file){
          const ref = storage.ref().child(`profiles/${uid}/${file.name}`);
          await ref.put(file);
          photoURL = await ref.getDownloadURL();
        }
        // create user doc
        await db.collection('users').doc(uid).set({
          fullName, username, email, phone, church, district, photoURL,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          lastSeen: firebase.firestore.FieldValue.serverTimestamp(),
          online: true
        });
        $('regMsg').innerText = 'Account created — signing in...';
        $('registerModal').classList.add('hidden'); $('registerModal').style.display = 'none';
        // auth state will change automatically
      } catch(err){
        console.error(err);
        $('regMsg').innerText = 'Registration error: ' + err.message;
      }
    });// ------------------------
    // Auth guard: hide nav until logged in
    // ------------------------
    auth.onAuthStateChanged(async user => {
      if(user){
        // user signed in — show nav and app
        console.log('Signed in as', user.uid);
        // show nav
        document.getElementById('topbar').style.display = 'block';
        // hide auth page
        document.getElementById('authSection').style.display = 'none';
        // show app content
        document.getElementById('appWrapper').classList.remove('hidden');
        document.getElementById('appWrapper').style.display = 'block';
        // set nav visible (already)
        // load home content and user-specific content
        loadUserProfile(user);
        // wire nav buttons now that they are visible
        bindNavButtons();
        // load events & leaders & hymn placeholders
        renderEvents();
        renderLeaders();
      } else {
        // signed out or no user — show only auth, hide nav & app
        console.log('Not signed in');
        document.getElementById('topbar').style.display = 'none';
        document.getElementById('authSection').style.display = 'block';
        document.getElementById('appWrapper').classList.add('hidden');
        document.getElementById('appWrapper').style.display = 'none';
      }
    });

    // sign out helper (accessible once nav appears)
    async function signOut(){
      try {
        await auth.signOut();
        // page will show auth UI via listener
      } catch(e){ console.error(e); }
    }

    // load user profile (display welcome)
    async function loadUserProfile(user){
      try{
        const doc = await db.collection('users').doc(user.uid).get();
        if(doc.exists){
          const d = doc.data();
          $('welcomeText').innerText = `Hello ${d.fullName || d.username || ''}. Welcome to Imperial Techub.`;
        } else {
          $('welcomeText').innerText = `Welcome, ${user.email || 'member'}.`;
        }
      } catch(e){ console.warn(e); $('welcomeText').innerText = 'Welcome.'; }
    }

    // nav behavior
    function bindNavButtons(){
      const buttons = document.querySelectorAll('.nav-btn');
      buttons.forEach(b => {
        b.addEventListener('click', (ev) => {
          const page = b.dataset.page;
          // simple small router: hide appWrapper main sections and show content accordingly
          // for demo, we only implement a few pages inline; others can be expanded later.
          document.querySelectorAll('main > section').forEach(s => s.style.display = 'none');
          // show app wrapper always (main area)
          document.getElementById('appWrapper').style.display = 'block';
          if(page === 'home'){ document.getElementById('home').style.display = 'block'; }
          else if(page === 'events'){ document.getElementById('eventsGrid').parentElement.style.display='block'; document.getElementById('eventsGrid').parentElement.scrollIntoView({behavior:'smooth'}); }
          else if(page === 'announcements'){ alert('Announcements page'); }
          else if(page === 'leaders'){ document.getElementById('leadersGrid').parentElement.scrollIntoView({behavior:'smooth'}); }
          else if(page === 'hymnbook'){ alert('Hymnbook — implement'); }
          else if(page === 'bible'){ alert('Bible — make sure /bible/*.txt exists'); }
          else if(page === 'chat'){ alert('Chat — implement full chat UI (next)'); }
        });
      });
    }

    // ------------------------
    // Small data placeholders: Events & Leaders
    // ------------------------
    const EVENTS = [
      { id:'youth-rally', title:'Youth Rally — PCEA Chieni Church', start:'2025-11-16T09:00:00', location:'PCEA Chieni Church' },
      { id:'presbytery', title:'Presbytery Youth Convention', start:'2025-12-02T09:00:00', location:'Presbytery Venue' },
      { id:'christmas', title:'Christmas Day', start:'2025-12-25T00:00:00', location:'All Parishes' },
      { id:'newyear', title:"New Year's Day", start:'2026-01-01T00:00:00', location:'All Parishes' }
    ];

    function renderEvents(){
      const grid = $('eventsGrid'); grid.innerHTML = '';
      const now = new Date();
      // compute diff and sort
      const mapped = EVENTS.map(e => {
        const sd = new Date(e.start);
        const diff = sd - now;
        return {...e, startDate:sd, diff};
      }).sort((a,b) => a.diff - b.diff);
      mapped.forEach(e => {
        const el = document.createElement('div');
        el.style.marginBottom='10px';
        el.innerHTML = `<strong>${e.title}</strong><div class="muted">${e.startDate.toDateString()} — ${e.location}</div><div id="cd-${e.id}" style="font-family:monospace;margin-top:6px;color:var(--accent)"></div>`;
        grid.appendChild(el);
      });
      // start interval for countdown
      setInterval(()=>{
        EVENTS.forEach(ev => {
          const el = document.getElementById('cd-'+ev.id);
          if(!el) return;
          const now = new Date();
          const diff = new Date(ev.start) - now;
          if(diff<=0){ el.innerText = 'Happening or Passed'; return; }
          const d = Math.floor(diff/(24*3600*1000));
          const h = Math.floor((diff % (24*3600*1000)) / (3600*1000));
          const m = Math.floor((diff % (3600*1000)) / (60000));
          const s = Math.floor((diff % 60000)/1000);
          el.innerText = `${d}d ${h}h ${m}m ${s}s`;
        });
      }, 1000);
    }

    function renderLeaders(){
      const leaders = [
        { office:"Zachary's Office", name:"Zachary Gikonyo", role:"Chairperson", phone:"+254742892647" },
        { office:"Dalson's Office", name:"Dalson Maina", role:"Vice Chairperson", phone:"+254714003648" },
        { office:"Ian's Office", name:"Ian Gathagu", role:"Secretary", phone:"+254718357417" },
        { office:"Lydia's Office", name:"Lydia Wamuyu", role:"Vice Secretary", phone:"+254110867929" },
        { office:"Winnie's Office", name:"Winnie Maundu", role:"Treasurer", phone:"+254713285534" }
      ];
      const grid = $('leadersGrid'); grid.innerHTML = '';
      leaders.forEach(ld => {
        const el = document.createElement('div');
        el.style.marginBottom='8px';
        el.innerHTML = `<div style="font-weight:800">${ld.office}</div><div class="muted">${ld.name} — ${ld.role}</div><div style="margin-top:6px"><a href="https://wa.me/${ld.phone.replace(/\D/g,'')}" target="_blank" style="background:#25D366;color:#012;padding:6px 8px;border-radius:8px;display:inline-block;margin-right:6px">WhatsApp</a><a href="tel:${ld.phone.replace(/\D/g,'')}" style="background:#ffd54f;color:#012;padding:6px 8px;border-radius:8px;display:inline-block">Call</a></div>`;
        grid.appendChild(el);
      });
    }// ------------------------
    // Final note: ensure Firestore & Auth enabled
    // ------------------------
    // If you see "auth/configuration-not-found" — ensure in Firebase Console you went to Authentication -> Get started and enabled Email/Password.
    // If you see Firestore errors, ensure Firestore database exists.
  </script>
</body>
</html>
